<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: Modules & Behaviors - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Behavior.html">Behavior</a><ul class='methods'><li data-type='method'><a href="Behavior.html#getStub">getStub</a></li><li data-type='method'><a href="Behavior.html#runTest">runTest</a></li></ul></li><li><a href="ExpectError.html">ExpectError</a></li><li><a href="Filter.html">Filter</a><ul class='methods'><li data-type='method'><a href="Filter.html#expectAll">expectAll</a></li><li data-type='method'><a href="Filter.html#expectCount">expectCount</a></li><li data-type='method'><a href="Filter.html#expectCountMax">expectCountMax</a></li><li data-type='method'><a href="Filter.html#expectCountMin">expectCountMin</a></li><li data-type='method'><a href="Filter.html#expectCountRange">expectCountRange</a></li><li data-type='method'><a href="Filter.html#expectNone">expectNone</a></li><li data-type='method'><a href="Filter.html#expectSome">expectSome</a></li><li data-type='method'><a href="Filter.html#filterByCallArgs">filterByCallArgs</a></li><li data-type='method'><a href="Filter.html#filterByCallContext">filterByCallContext</a></li><li data-type='method'><a href="Filter.html#filterByException">filterByException</a></li><li data-type='method'><a href="Filter.html#filterByNumber">filterByNumber</a></li><li data-type='method'><a href="Filter.html#filterByReturn">filterByReturn</a></li><li data-type='method'><a href="Filter.html#filterFifth">filterFifth</a></li><li data-type='method'><a href="Filter.html#filterFirst">filterFirst</a></li><li data-type='method'><a href="Filter.html#filterFourth">filterFourth</a></li><li data-type='method'><a href="Filter.html#filterLast">filterLast</a></li><li data-type='method'><a href="Filter.html#filterOnly">filterOnly</a></li><li data-type='method'><a href="Filter.html#filterPropGet">filterPropGet</a></li><li data-type='method'><a href="Filter.html#filterPropSet">filterPropSet</a></li><li data-type='method'><a href="Filter.html#filterPropSetByVal">filterPropSetByVal</a></li><li data-type='method'><a href="Filter.html#filterSecond">filterSecond</a></li><li data-type='method'><a href="Filter.html#filterThird">filterThird</a></li><li data-type='method'><a href="Filter.html#getAllCallArgs">getAllCallArgs</a></li><li data-type='method'><a href="Filter.html#getAllCallContexts">getAllCallContexts</a></li><li data-type='method'><a href="Filter.html#getAllExceptions">getAllExceptions</a></li><li data-type='method'><a href="Filter.html#getAllReturns">getAllReturns</a></li><li data-type='method'><a href="Filter.html#getAllSetVals">getAllSetVals</a></li></ul></li><li><a href="Interface.html">Interface</a></li><li><a href="InterfaceBehavior.html">InterfaceBehavior</a><ul class='methods'><li data-type='method'><a href="InterfaceBehavior.html#args">args</a></li><li data-type='method'><a href="InterfaceBehavior.html#context">context</a></li><li data-type='method'><a href="InterfaceBehavior.html#returns">returns</a></li><li data-type='method'><a href="InterfaceBehavior.html#set">set</a></li><li data-type='method'><a href="InterfaceBehavior.html#throws">throws</a></li></ul></li><li><a href="Match.html">Match</a><ul class='methods'><li data-type='method'><a href="Match.html#.addType">addType</a></li><li data-type='method'><a href="Match.html#.diff">diff</a></li><li data-type='method'><a href="Match.html#.getType">getType</a></li><li data-type='method'><a href="Match.html#.type">type</a></li><li data-type='method'><a href="Match.html#.value">value</a></li><li data-type='method'><a href="Match.html#compare">compare</a></li></ul></li><li><a href="Module.html">Module</a><ul class='methods'><li data-type='method'><a href="Module.html#defineBehavior">defineBehavior</a></li><li data-type='method'><a href="Module.html#defineMethod">defineMethod</a></li><li data-type='method'><a href="Module.html#defineProperty">defineProperty</a></li><li data-type='method'><a href="Module.html#defineTest">defineTest</a></li><li data-type='method'><a href="Module.html#getBehavior">getBehavior</a></li><li data-type='method'><a href="Module.html#getInterface">getInterface</a></li><li data-type='method'><a href="Module.html#getStub">getStub</a></li><li data-type='method'><a href="Module.html#getTest">getTest</a></li><li data-type='method'><a href="Module.html#getTestList">getTestList</a></li><li data-type='method'><a href="Module.html#runAllTests">runAllTests</a></li></ul></li><li><a href="Operation.html">Operation</a><ul class='methods'><li data-type='method'><a href="Operation.html#.expectCallArgs">expectCallArgs</a></li><li data-type='method'><a href="Operation.html#.expectCallContext">expectCallContext</a></li><li data-type='method'><a href="Operation.html#.expectCustom">expectCustom</a></li><li data-type='method'><a href="Operation.html#.expectException">expectException</a></li><li data-type='method'><a href="Operation.html#.expectReturn">expectReturn</a></li><li data-type='method'><a href="Operation.html#.expectSetVal">expectSetVal</a></li></ul></li><li><a href="Sandbox.html">Sandbox</a><ul class='methods'><li data-type='method'><a href="Sandbox.html#.singletonEnd">singletonEnd</a></li><li data-type='method'><a href="Sandbox.html#.singletonGetCurrent">singletonGetCurrent</a></li><li data-type='method'><a href="Sandbox.html#.singletonStart">singletonStart</a></li><li data-type='method'><a href="Sandbox.html#.test">test</a></li><li data-type='method'><a href="Sandbox.html#.testAsync">testAsync</a></li><li data-type='method'><a href="Sandbox.html#destroy">destroy</a></li><li data-type='method'><a href="Sandbox.html#newWrapper">newWrapper</a></li></ul></li><li><a href="Trigger.html">Trigger</a><ul class='methods'><li data-type='method'><a href="Trigger.html#.expectCallArgs">expectCallArgs</a></li><li data-type='method'><a href="Trigger.html#.expectCallContext">expectCallContext</a></li><li data-type='method'><a href="Trigger.html#.expectCustom">expectCustom</a></li><li data-type='method'><a href="Trigger.html#.expectException">expectException</a></li><li data-type='method'><a href="Trigger.html#.expectReturn">expectReturn</a></li><li data-type='method'><a href="Trigger.html#.expectSetVal">expectSetVal</a></li><li data-type='method'><a href="Trigger.html#actionCallArgs">actionCallArgs</a></li><li data-type='method'><a href="Trigger.html#actionCallbackArgs">actionCallbackArgs</a></li><li data-type='method'><a href="Trigger.html#actionCallbackContext">actionCallbackContext</a></li><li data-type='method'><a href="Trigger.html#actionCallbackFunction">actionCallbackFunction</a></li><li data-type='method'><a href="Trigger.html#actionCallbackToArg">actionCallbackToArg</a></li><li data-type='method'><a href="Trigger.html#actionCallContext">actionCallContext</a></li><li data-type='method'><a href="Trigger.html#actionCustom">actionCustom</a></li><li data-type='method'><a href="Trigger.html#actionReturn">actionReturn</a></li><li data-type='method'><a href="Trigger.html#actionReturnContext">actionReturnContext</a></li><li data-type='method'><a href="Trigger.html#actionReturnFromArg">actionReturnFromArg</a></li><li data-type='method'><a href="Trigger.html#actionReturnFromContext">actionReturnFromContext</a></li><li data-type='method'><a href="Trigger.html#actionReturnRejectedPromise">actionReturnRejectedPromise</a></li><li data-type='method'><a href="Trigger.html#actionReturnResolvedPromise">actionReturnResolvedPromise</a></li><li data-type='method'><a href="Trigger.html#actionSetVal">actionSetVal</a></li><li data-type='method'><a href="Trigger.html#actionThrowException">actionThrowException</a></li></ul></li><li><a href="Wrapper.html">Wrapper</a><ul class='methods'><li data-type='method'><a href="Wrapper.html#.getWrapperFromProperty">getWrapperFromProperty</a></li><li data-type='method'><a href="Wrapper.html#.isWrapper">isWrapper</a></li><li data-type='method'><a href="Wrapper.html#.unwrap">unwrap</a></li><li data-type='method'><a href="Wrapper.html#configAllowRewrap">configAllowRewrap</a></li><li data-type='method'><a href="Wrapper.html#configCallUnderlying">configCallUnderlying</a></li><li data-type='method'><a href="Wrapper.html#configDefault">configDefault</a></li><li data-type='method'><a href="Wrapper.html#configExpectThrows">configExpectThrows</a></li><li data-type='method'><a href="Wrapper.html#configExpectThrowsOnTrigger">configExpectThrowsOnTrigger</a></li><li data-type='method'><a href="Wrapper.html#configReset">configReset</a></li><li data-type='method'><a href="Wrapper.html#configSwallowExpectException">configSwallowExpectException</a></li><li data-type='method'><a href="Wrapper.html#configUnwrap">configUnwrap</a></li><li data-type='method'><a href="Wrapper.html#expectReportAllFailures">expectReportAllFailures</a></li><li data-type='method'><a href="Wrapper.html#triggerAlways">triggerAlways</a></li><li data-type='method'><a href="Wrapper.html#triggerOnCallArgs">triggerOnCallArgs</a></li><li data-type='method'><a href="Wrapper.html#triggerOnCallContext">triggerOnCallContext</a></li><li data-type='method'><a href="Wrapper.html#triggerOnCallNumber">triggerOnCallNumber</a></li><li data-type='method'><a href="Wrapper.html#triggerOnCustom">triggerOnCustom</a></li><li data-type='method'><a href="Wrapper.html#triggerOnException">triggerOnException</a></li><li data-type='method'><a href="Wrapper.html#triggerOnGet">triggerOnGet</a></li><li data-type='method'><a href="Wrapper.html#triggerOnGetNumber">triggerOnGetNumber</a></li><li data-type='method'><a href="Wrapper.html#triggerOnReturn">triggerOnReturn</a></li><li data-type='method'><a href="Wrapper.html#triggerOnSet">triggerOnSet</a></li><li data-type='method'><a href="Wrapper.html#triggerOnSetNumber">triggerOnSetNumber</a></li><li data-type='method'><a href="Wrapper.html#triggerOnSetVal">triggerOnSetVal</a></li><li data-type='method'><a href="Wrapper.html#triggerOnTouchNumber">triggerOnTouchNumber</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-getting-started.html">Getting Started</a></li><li><a href="tutorial-modules-and-behaviors.html">Modules & Behaviors</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial: Modules & Behaviors</h1>
    

    <section>

<header>
    

    <h2>Modules & Behaviors</h2>
</header>

<article>
    <p><a href="Module.html">Modules</a>, and their associated <a href="Interface.html">Interfaces</a> and <a href="Behavior.html">Behaviors</a>, are a way of programmatically defining and testing the behavior of an API. Modules are intended to be a single <code>Object</code> that contains method functions and properties -- which are referred to as the <code>Interfaces</code><sup>*</sup>.</p>
<p>For every interface, a set of <code>Behaviors</code> can be defined for the interface -- how the interface behaves with different arguments, what values it returns, when it might throw errors, etc. These <code>Behaviors</code> can then be used to generate a stub <code>Wrapper</code> or a set of tests for testing instances of the <code>Module</code>.</p>
<p>The sections that follow walk through how to create a <code>Module</code>, define its <code>Intefaces</code> and <code>Behaviors</code>, and then use it to create stubs and tests.</p>
<p>(<sup>*</sup> Okay, I admit that <code>Interface</code> may not be a perfect name. I'm open to other ideas.)</p>
<h2>Defining a Module</h2><p>Defining a module is easy:</p>
<pre class="prettyprint source lang-js"><code>var myModule = new Module();</code></pre><p>There's nothing fancy here -- a <code>Module</code> is just a container for the interfaces and behaviors.</p>
<h2>Defining Interfaces</h2><p><code>Interfaces</code> are technically properties on the <code>Module</code> object that provide ways of interacting with the module. There are two types of interfaces: 1) function / method interfaces; and 2) property interfaces. While there is an <a href="Interface.html">Interface Class</a>, interfaces should be created by calling the <a href="Module.html#defineMethod">defineMethod</a> and <a href="Module.html#defineProperty">defineProperty</a> methods on the <code>Module</code>:</p>
<pre class="prettyprint source lang-js"><code>var carModule = new Module();

// define a function for the module
carModule.defineMethod(&quot;startEngine&quot;);
// define a property for the module
carModule.defineProperty(&quot;currentSpeed&quot;);</code></pre><p>These interfaces won't do anything interesting until we define their behaviors.</p>
<h2>Defining Behaviors</h2><p>Every <code>Interface</code> can have multiple <code>Behaviors</code> -- and should have at least one <code>Behavior</code>. These behaviors describe what the <code>Interface</code> is expected to do in different conditions. If no behaviors are defined for an <code>Interface</code>, then it will essentially do nothing and be useless.</p>
<p>Defining behaviors is easy, and is closely related to the <a href="Operation.html">Operation</a> interface for Wrappers. Method interfaces can have arguments, context (<code>this</code> value`), throw exceptions, or return values. Properties can have set values, get values, or throw exceptions. Here are some examples of defining behaviors:</p>
<pre class="prettyprint source lang-js"><code>var carModule = new Module();

// define a function for the module
carModule.defineMethod(&quot;startEngine&quot;);
// successfully start the engine
carModule.defineBehavior(&quot;startEngineSuccess&quot;)
    .startEngine()
    .args(&quot;key&quot;)
    .returns(true);
// fail to start the engine because no key was provided
carModule.defineBehavior(&quot;startEngineNoKey&quot;)
    .startEngine()
    .args()
    .throws(new Error(&quot;no key provided&quot;));

// define a property for the module
carModule.defineProperty(&quot;currentSpeed&quot;);
// property returns 10 when going slow
carModule.defineBehavior(&quot;currentSpeedSlow&quot;)
    .currentSpeed()
    .returns(10);
// property returns 70 when at cruising speed
carModule.defineBehavior(&quot;currentSpeedCruise&quot;)
    .currentSpeed()
    .returns(70);
// property returns 120 when going fast
carModule.defineBehavior(&quot;currentSpeedFast&quot;)
    .currentSpeed()
    .returns(120);</code></pre><p>You will notice that the general pattern of these is to call <a href="Module.html#defineBehavior">defineBehavior</a>, followed by chaining the name of the interface that is to be defined and the expected behavior of that interface.</p>
<p>Behaviors can be nested, so building on the behaviors that were defined above we can define a new <code>accelerate</code> behavior:</p>
<pre class="prettyprint source lang-js"><code>carModule.defineBehavior(&quot;accelerate&quot;)
    .startEngineSuccess()
    .currentSpeedSlow()
    .currentSpeedCruise()
    .currentSpeedFast();</code></pre><p>The <code>accelerate</code> behavior expects the car to be started through a <code>startEngine()</code> call, and then for the <code>currentSpeed</code> property to be <code>10</code>, <code>70</code>, and <code>120</code> the next three times it is checked.</p>
<p>Now that we have defined some behaviors, we can use them to create stubs or tests.</p>
<h2>Behavior Stubs</h2><p>A behavior stub is essentially a <a href="Wrapper.html">Wrapper</a> that performs the behavior described by the <code>Behavior</code>. These are simple to create, for example using the behaviors defined in the previous section we could create a stub like this:</p>
<pre class="prettyprint source lang-js"><code>var myCarStartEngineStub = carModule.getStub(&quot;startEngineSuccess&quot;);</code></pre><p>In this case, <a href="Module.html#getStub">getStub</a> would return an <code>Object</code> with the method <code>startEngine</code> defined on it. When called the first time, the <code>startEngine</code> would throw an <a href="ExpectError.html">ExpectError</a> if the first argument isn't <code>&quot;key&quot;</code>, or would return <code>true</code> if the first argument was <code>&quot;key&quot;</code>. Since only the first behavior of <code>startEngine</code> is defined, each subsequent time the method is called it would return <code>undefined</code> and wouldn't have any expectations for the arguments.</p>
<p>Since <code>currentSpeed</code> isn't defined as part of the <code>Behavior</code> it wouldn't be defined on the stub behavior.</p>
<p>This stub could be used wherever you wanted to use your <code>carModule</code> in your testing.</p>
<h2>Running Tests</h2><p>Similar to getting a behavior stub, it is easy to test that an instance of a module has the expected behaviors. Since all behaviors may not be testable in a stand-alone fashion, it is necessary to define which behaviors should be tested. For example, it may not be desirable to test the current speed of the car without first starting the car, so <code>currentSpeedCruise</code> shouldn't be tested by itself.</p>
<p>For our module, let's assume that there are three behaviors that we want to test:</p>
<pre class="prettyprint source lang-js"><code>carModule.defineTest(&quot;startEngineSuccess&quot;, &quot;start the car's engine&quot;);
carModule.defineTest(&quot;startEngineNoKey&quot;, &quot;fails to start the engine without a key&quot;);
carModule.defineTest(&quot;accelerate&quot;, &quot;start the engine and current speed gets faster&quot;);</code></pre><p>You'll notice that the second argument to <a href="Module.html#defineTest">defineTest</a> is an optional description of the test. This is useful for running the tests, as we will see momentarily.</p>
<p>Now let's define our module to be tested:</p>
<pre class="prettyprint source lang-js"><code>var myFerrari = {
    startEngine = function(key) {
        if (key !== &quot;key&quot;) throw new Error (&quot;no key provided&quot;);
        return true;
    },
    currentSpeed: 0
}</code></pre><p>Now we can run the tests against my instance of the module:</p>
<pre class="prettyprint source lang-js"><code>describe (&quot;my ferrari&quot;, function() {
    mod.runAllTests(myFerrari, it);
});</code></pre><p>This runs all the defined tests against the <code>myFerrari</code> module. Note that <code>describe</code> and <code>it</code> are from a test runner like <a href="https://mochajs.org/">Mocha</a> or <a href="https://jasmine.github.io/">Jasmine</a>. (The <code>describe</code> function has nothing to do with this library, other than the fact that the <code>it</code> function of those libraries does nothing if it isn't inside a <code>describe</code> function). The <code>it</code> function is called with the arguments <code>desc</code> and <code>function</code> that were defined for your behavior, where the <code>function</code> will throw if there is an error.</p>
<p>If you are using a test runner that doesn't have a testing function that follows the <code>test(desc, fn)</code> format, just provide your own callback function and call the function directly:</p>
<pre class="prettyprint source lang-js"><code>mod.runAllTests(myFerrari, function(desc, fn) {
    myTestSuite(fn); // or whatever your test runner requires...
});</code></pre><p>(Note that our example module fails the tests since the cruise speed never changes... guess we will have to create a <code>applyGasPedal</code> method and add that to the <code>Behavior</code>. This is left as an exercise for the reader.)</p>
<h2>Integration Testing</h2><p>If it isn't already obvious, stubs are to be used where you module should be consumed and tests are to be used for instances of the module. Stubs and tests should test the same behaviors, ensuring that when a stub is replaced with an actual instance of module that the instance of the module behaves exactly as the stub did.</p>
<p>Since stubs and tests are mirror images of each other, the following should always work:</p>
<pre class="prettyprint source lang-js"><code>var stub = module.getStub(&quot;behavior&quot;);
var test = module.getTest(&quot;behavior&quot;, myModule);
test(stub); // success!</code></pre>
</article>

</section>

</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Apr 18 2017 03:25:43 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>