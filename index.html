<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ExpectError.html">ExpectError</a></li><li><a href="Filter.html">Filter</a><ul class='methods'><li data-type='method'><a href="Filter.html#expectAll">expectAll</a></li><li data-type='method'><a href="Filter.html#expectCount">expectCount</a></li><li data-type='method'><a href="Filter.html#expectCountMax">expectCountMax</a></li><li data-type='method'><a href="Filter.html#expectCountMin">expectCountMin</a></li><li data-type='method'><a href="Filter.html#expectCountRange">expectCountRange</a></li><li data-type='method'><a href="Filter.html#expectNone">expectNone</a></li><li data-type='method'><a href="Filter.html#expectSome">expectSome</a></li><li data-type='method'><a href="Filter.html#filterByCallArgs">filterByCallArgs</a></li><li data-type='method'><a href="Filter.html#filterByCallContext">filterByCallContext</a></li><li data-type='method'><a href="Filter.html#filterByException">filterByException</a></li><li data-type='method'><a href="Filter.html#filterByNumber">filterByNumber</a></li><li data-type='method'><a href="Filter.html#filterByReturn">filterByReturn</a></li><li data-type='method'><a href="Filter.html#filterFifth">filterFifth</a></li><li data-type='method'><a href="Filter.html#filterFirst">filterFirst</a></li><li data-type='method'><a href="Filter.html#filterFourth">filterFourth</a></li><li data-type='method'><a href="Filter.html#filterLast">filterLast</a></li><li data-type='method'><a href="Filter.html#filterOnly">filterOnly</a></li><li data-type='method'><a href="Filter.html#filterPropGet">filterPropGet</a></li><li data-type='method'><a href="Filter.html#filterPropSet">filterPropSet</a></li><li data-type='method'><a href="Filter.html#filterPropSetByVal">filterPropSetByVal</a></li><li data-type='method'><a href="Filter.html#filterSecond">filterSecond</a></li><li data-type='method'><a href="Filter.html#filterThird">filterThird</a></li><li data-type='method'><a href="Filter.html#getAllCallArgs">getAllCallArgs</a></li><li data-type='method'><a href="Filter.html#getAllCallContexts">getAllCallContexts</a></li><li data-type='method'><a href="Filter.html#getAllExceptions">getAllExceptions</a></li><li data-type='method'><a href="Filter.html#getAllReturns">getAllReturns</a></li><li data-type='method'><a href="Filter.html#getAllSetVals">getAllSetVals</a></li></ul></li><li><a href="Match.html">Match</a><ul class='methods'><li data-type='method'><a href="Match.html#.addType">addType</a></li><li data-type='method'><a href="Match.html#.diff">diff</a></li><li data-type='method'><a href="Match.html#.getType">getType</a></li><li data-type='method'><a href="Match.html#.type">type</a></li><li data-type='method'><a href="Match.html#.value">value</a></li><li data-type='method'><a href="Match.html#compare">compare</a></li></ul></li><li><a href="Operation.html">Operation</a><ul class='methods'><li data-type='method'><a href="Operation.html#.expectCallArgs">expectCallArgs</a></li><li data-type='method'><a href="Operation.html#.expectCallContext">expectCallContext</a></li><li data-type='method'><a href="Operation.html#.expectCustom">expectCustom</a></li><li data-type='method'><a href="Operation.html#.expectException">expectException</a></li><li data-type='method'><a href="Operation.html#.expectReturn">expectReturn</a></li><li data-type='method'><a href="Operation.html#.expectSetVal">expectSetVal</a></li></ul></li><li><a href="Sandbox.html">Sandbox</a><ul class='methods'><li data-type='method'><a href="Sandbox.html#.singletonStart">singletonStart</a></li><li data-type='method'><a href="Sandbox.html#.test">test</a></li><li data-type='method'><a href="Sandbox.html#.testAsync">testAsync</a></li><li data-type='method'><a href="Sandbox.html#destroy">destroy</a></li><li data-type='method'><a href="Sandbox.html#newWrapper">newWrapper</a></li></ul></li><li><a href="Trigger.html">Trigger</a><ul class='methods'><li data-type='method'><a href="Trigger.html#.expectCallArgs">expectCallArgs</a></li><li data-type='method'><a href="Trigger.html#.expectCallContext">expectCallContext</a></li><li data-type='method'><a href="Trigger.html#.expectCustom">expectCustom</a></li><li data-type='method'><a href="Trigger.html#.expectException">expectException</a></li><li data-type='method'><a href="Trigger.html#.expectReturn">expectReturn</a></li><li data-type='method'><a href="Trigger.html#.expectSetVal">expectSetVal</a></li><li data-type='method'><a href="Trigger.html#actionCallArgs">actionCallArgs</a></li><li data-type='method'><a href="Trigger.html#actionCallbackArgs">actionCallbackArgs</a></li><li data-type='method'><a href="Trigger.html#actionCallbackContext">actionCallbackContext</a></li><li data-type='method'><a href="Trigger.html#actionCallbackFunction">actionCallbackFunction</a></li><li data-type='method'><a href="Trigger.html#actionCallbackToArg">actionCallbackToArg</a></li><li data-type='method'><a href="Trigger.html#actionCallContext">actionCallContext</a></li><li data-type='method'><a href="Trigger.html#actionCustom">actionCustom</a></li><li data-type='method'><a href="Trigger.html#actionReturn">actionReturn</a></li><li data-type='method'><a href="Trigger.html#actionReturnContext">actionReturnContext</a></li><li data-type='method'><a href="Trigger.html#actionReturnFromArg">actionReturnFromArg</a></li><li data-type='method'><a href="Trigger.html#actionReturnFromContext">actionReturnFromContext</a></li><li data-type='method'><a href="Trigger.html#actionReturnRejectedPromise">actionReturnRejectedPromise</a></li><li data-type='method'><a href="Trigger.html#actionReturnResolvedPromise">actionReturnResolvedPromise</a></li><li data-type='method'><a href="Trigger.html#actionSetVal">actionSetVal</a></li><li data-type='method'><a href="Trigger.html#actionThrowException">actionThrowException</a></li></ul></li><li><a href="Wrapper.html">Wrapper</a><ul class='methods'><li data-type='method'><a href="Wrapper.html#.getWrapperFromProperty">getWrapperFromProperty</a></li><li data-type='method'><a href="Wrapper.html#.isWrapper">isWrapper</a></li><li data-type='method'><a href="Wrapper.html#.unwrap">unwrap</a></li><li data-type='method'><a href="Wrapper.html#configAllowRewrap">configAllowRewrap</a></li><li data-type='method'><a href="Wrapper.html#configCallUnderlying">configCallUnderlying</a></li><li data-type='method'><a href="Wrapper.html#configDefault">configDefault</a></li><li data-type='method'><a href="Wrapper.html#configExpectThrows">configExpectThrows</a></li><li data-type='method'><a href="Wrapper.html#configExpectThrowsOnTrigger">configExpectThrowsOnTrigger</a></li><li data-type='method'><a href="Wrapper.html#configReset">configReset</a></li><li data-type='method'><a href="Wrapper.html#configSwallowExpectException">configSwallowExpectException</a></li><li data-type='method'><a href="Wrapper.html#configUnwrap">configUnwrap</a></li><li data-type='method'><a href="Wrapper.html#expectReportAllFailures">expectReportAllFailures</a></li><li data-type='method'><a href="Wrapper.html#triggerAlways">triggerAlways</a></li><li data-type='method'><a href="Wrapper.html#triggerOnCallArgs">triggerOnCallArgs</a></li><li data-type='method'><a href="Wrapper.html#triggerOnCallContext">triggerOnCallContext</a></li><li data-type='method'><a href="Wrapper.html#triggerOnCallNumber">triggerOnCallNumber</a></li><li data-type='method'><a href="Wrapper.html#triggerOnCustom">triggerOnCustom</a></li><li data-type='method'><a href="Wrapper.html#triggerOnException">triggerOnException</a></li><li data-type='method'><a href="Wrapper.html#triggerOnGet">triggerOnGet</a></li><li data-type='method'><a href="Wrapper.html#triggerOnGetNumber">triggerOnGetNumber</a></li><li data-type='method'><a href="Wrapper.html#triggerOnReturn">triggerOnReturn</a></li><li data-type='method'><a href="Wrapper.html#triggerOnSet">triggerOnSet</a></li><li data-type='method'><a href="Wrapper.html#triggerOnSetNumber">triggerOnSetNumber</a></li><li data-type='method'><a href="Wrapper.html#triggerOnSetVal">triggerOnSetVal</a></li><li data-type='method'><a href="Wrapper.html#triggerOnTouchNumber">triggerOnTouchNumber</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-getting-started.html">Getting Started</a></li></ul>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><p><strong>This project is currently in BETA. APIs may be subject to frequent change prior to the 1.0 release. Please use very strict versioning in your <code>package.json</code> if you choose to use candy-wrapper at this time.</strong></p>
<p><img src="https://cdn.rawgit.com/apowers313/candy-wrapper/2e325ece/img/candy-wrapper-full-logo-1116x200.png?raw=true" alt="##candy-wrapper"></p>
<p><a href="https://travis-ci.org/apowers313/candy-wrapper"><img src="https://travis-ci.org/apowers313/candy-wrapper.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/apowers313/candy-wrapper?branch=master"><img src="https://coveralls.io/repos/github/apowers313/candy-wrapper/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://waffle.io/apowers313/candy-wrapper"><img src="https://badge.waffle.io/apowers313/candy-wrapper.png?label=ready&amp;title=Ready" alt="Stories in Ready"></a></p>
<p><a href="https://saucelabs.com/beta/builds/011f525b0b50411290a7040eaa686fc2"><img src="https://saucelabs.com/browser-matrix/apowers313.svg" alt="Sauce Test Status"></a></p>
<p><a href="https://apowers313.github.io/candy-wrapper">Full API Documentation Available Here!</a></p>
<p>Questions, comments, bugs, suggestions, contributions, etc. are welcomed. Please submit an <a href="https://github.com/apowers313/candy-wrapper/issues">issue on GitHub</a>.</p>
<h2>Overview</h2><p>This library provides the ability to wrap functions or properties so that you can monitor their behavior without changing it. Wrappers also allow you to decide when and how you want to change the behavior of a function or property. Candy-wrapper is similar to wonderful libraries like <a href="http://sinonjs.org/">Sinon</a> and <a href="https://www.npmjs.com/package/shimmer">shimmer</a> and can be used for creating stubs, spys, and mocks for testing and monkey patching in production environments. The motivation behind creating candy-wrapper was that other libraries were too hard to learn, had inconsistent APIs, or generally couldn't do the things I needed to do with a wrapper. Hopefully candy-wrapper does everything anyone could ever hope for from a wrapper, or can be easily expanded to add new functionality.</p>
<p>The primary interfaces are Wrapper, Expect, Trigger, and Action:</p>
<ul>
<li><a href="https://apowers313.github.io/candy-wrapper/Wrapper.html">Wrappers</a> wrap a function or property, so that when the Wrapper is called, so is the underlying function or property.</li>
<li>You can use <a href="https://apowers313.github.io/candy-wrapper/Expect.html">Expect</a> to examine what happened with a Wrapper, such as seeing what args were passed to it or what the return value was.</li>
<li><a href="https://apowers313.github.io/candy-wrapper/Trigger.html">Triggers</a> get called just before or just after a function call, providing the opportunity validate Expects or perform Actions.</li>
<li>Actions, which are part of Triggers, can do things like change arguments recieved by the wrapped function or change the value returned to the caller.</li>
</ul>
<p>If you are new to wrappers or candy-wrapper, a good place to start is the <a href="https://apowers313.github.io/candy-wrapper/tutorial-getting-started.html">Getting Started Tutorial</a>.</p>
<h2>ES6</h2><p>Note that this library currently makes exensive use of the features of <a href="http://www.ecma-international.org/ecma-262/6.0/">JavaScript ES6</a>, notably <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxies</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes">classes</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">template literals</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters">rest parameters</a>, and the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator">spread operator</a>. For information about which platforms currently support ES6, see the <a href="https://kangax.github.io/compat-table/es6/">ES6 compatibility table</a>. It has been tested against Node 6 and is tested against the latest versions of Chrome, Firefox, Edge, and Safari.</p>
<p>Presumably it could be back-ported to ES5.1, perhaps drawing on the work of Sinon. The biggest challenge would be removing the use of Proxies. A <a href="https://github.com/apowers313/candy-wrapper">pull request</a> would be more than welcome if anyone wants to take that challenge on.</p>
<h2>Installing and Using</h2><h3>node.js</h3><p>Install:</p>
<pre class="prettyprint source lang-bash"><code>$ npm install candy-wrapper</code></pre><p>Use:</p>
<pre class="prettyprint source lang-js"><code>var Wrapper = require(&quot;candy-wrapper&quot;).Wrapper;
new Wrapper();</code></pre><h3>Browser</h3><p>Install:</p>
<pre class="prettyprint source lang-html"><code>&lt;script src=https://rawgit.com/apowers313/candy-wrapper/master/candy-wrapper.js>&lt;/script></code></pre><p>Use:</p>
<pre class="prettyprint source lang-html"><code>&lt;script>
var Wrapper = CandyWrapper.Wrapper;
&lt;/script></code></pre><h2>Examples</h2><p>Here are few example use cases to get you started with candy-wrapper...</p>
<h3>Spys</h3><p>Let's say that you have already written some code and now you want to test it to make sure it works right. Your very simple function <code>square()</code> simply takes a number and squares it and you want to make sure it's working right.</p>
<pre class="prettyprint source lang-js"><code>// our simple square function, squares the number passed in
// throws error if the argument isn't a number
var square = function(num) {
    if (typeof num !== &quot;number&quot;) {
        throw new TypeError (&quot;expected argument to be Number&quot;);
    }

    return num * num;
};

// wrap square so that we can analyze it later
square = new Wrapper(square);

// let's make some calls to square
square(2);
square(4);
try { // gobble up the exception from no arguments
    square();
} catch(e) {}
square(3);
square(5);

square.historyList.filterFirst().expectReturn(4); // true
square.historyList.filterSecond().expectReturn(16); // true
square.historyList.filterThird().expectException(new TypeError (&quot;expected argument to be Number&quot;)); // true
square.historyList.filterFourth().expectReturn(10); // false, actually returned 9
square.historyList.filterFifth().expectReturn(23); // false, actually returned 25

square.expectReportAllFailures();
// ExpectError: 2 expectation(s) failed:
//     expectReturn: expectation failed for: 10
//     expectReturn: expectation failed for: 23</code></pre><h3>Stubs</h3><p>Let's say you're working on a big complex system that's eventually going to hook up to a database, but you really don't want to have to write all the database code before you can start working on the more interesting code that would rely on it. If only you could create a fake database object that behaved like the real thing...</p>
<pre class="prettyprint source lang-js"><code>var fakeDb = {};
fakeDb.getUser = new Wrapper(); // create a stub function for getUser...
fakeDb.listUsers = new Wrapper(); // create a stub function for listUsers...

// when `fakeDb.getUser` is called with the argument &quot;apwoers&quot;, it returns the object below
fakeDb.getUser.triggerOnArgs(&quot;apowers&quot;)
    .actionReturn({
        username: &quot;apowers&quot;,
        firstName: &quot;Adam&quot;,
        lastName: &quot;Powers&quot;
    });

// everytime `fakeDb.listUsers` is called, it returns the same array...
fakeDb.listUsers.triggerAlways()
    .actionReturn([{
        username: &quot;apowers&quot;,
        firstName: &quot;Adam&quot;,
        lastName: &quot;Powers&quot;
    }, {
        username: &quot;bhope&quot;,
        firstName: &quot;Bob&quot;,
        lastName: &quot;Hope&quot;
    }]);

var user = fakeDb.getUser(&quot;apowers&quot;); // returns a user object...
var userList = fakeDb.listUsers(); // returns an array of users...</code></pre><h3>Mocks</h3><p>Now let's say it's been a few months, and your system is almost completely done. You have completed your real database, and you're having some sort of error that you suspect is due to your database timing out. You want to simulate errors with your database, but it's not easy to figure out how to make it time out when you want it to. Instead, you can just wrap your database object in a mock and start injecting errors...</p>
<pre class="prettyprint source lang-js"><code>// this is your big complex interface to a MongoDB database
var mysqlDbInterface = {
    // ...
    getUser: function() {
        // make database call here
    }
    // ...
};

var getUserWrapper = new Wrapper(mysqlDbInterface, &quot;getUser&quot;);
getUserWrapper.triggerOnCallNumber(2)
    .actionThrowException(new Error(&quot;Connection to mySQL timed out&quot;));

// start server
// the third call to `mysqlDbInterface.getUser()` will throw a timeout Error now..</code></pre><h3>Monkey Patching</h3><p>Let's say that you are tired of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random">Math.random()</a> being a pseudo-random number generator and you want it to use your <a href="https://software.intel.com/en-us/articles/intel-digital-random-number-generator-drng-software-implementation-guide">Digital Random Number Generator (DRNG)</a> instead. Using candy-wrapper, you can <a href="https://en.wikipedia.org/wiki/Monkey_patch">monkey patch</a> (that is, replace) <code>Math.random()</code> with your DRNG:</p>
<pre class="prettyprint source lang-js"><code>// replace &quot;Math.random&quot; with the new function of our choosing...
new Wrapper(Math, &quot;random&quot;, function() {
    return 1.2345; // this is where you would call your DRNG...
});

// let's see what it does...
Math.random() // returns 1.2345

// check to see if Math.random is a Wrapper
Wrapper.isWrapper(Math, &quot;random&quot;); // true

// this is probably a bad idea, let's go back to the original random number generator...
Wrapper.unwrap(Math, &quot;random&quot;);</code></pre></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sat Apr 15 2017 18:13:00 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>